
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Effective Portfolio &#8212; Making Money in Stocks</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"R": "\\mathbb{R}", "C": "\\mathbb{C}", "F": "\\mathbb{F}", "N": "\\mathbb{N}", "Ns": "\\mathbb{N^\\ast}", "Z": "\\mathbb{Z}", "Q": "\\mathbb{Q}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"], "abs": ["\\left\\lvert #1 \\right\\rvert", 1], "norm": ["\\left\\lVert #1 \\right\\rVert", 1], "argmin": ["\\mathop{\\mathrm{arg \\, min}}"], "argmax": ["\\mathop{\\mathrm{arg \\, max}}"], "d": ["\\mathrm{d}"], "v": ["\\mathbf{#1}", 1]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/icon.jpg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="News Investigation" href="../news-investigation/index.html" />
    <link rel="prev" title="Trading by Prediction" href="trading-by-prediction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/icon.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Making Money in Stocks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Making Money in Stocks
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data-collecting-and-visualization/index.html">
   Data Collecting and Visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-collecting-and-visualization/data-collecting.html">
     Scraping Stock Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-collecting-and-visualization/visualization.html">
     Visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../closing-price-prediction/index.html">
   Closing Price Prediction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../closing-price-prediction/arima.html">
     Closing Price Prediction with ARIMA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../closing-price-prediction/multivariate-time-series.html">
     LSTM for Multivariate Time Series
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Trading Strategy
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="simple-moving-average.html">
     Simple Moving Average
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="trading-by-prediction.html">
     Trading by Prediction
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Effective Portfolio
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../news-investigation/index.html">
   News Investigation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../news-investigation/news-scraping.html">
     News Scraping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../news-investigation/quantification.html">
     Quantification
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Isaac-Fate/stox/master?urlpath=tree/book/trading-strategy/effective-portfolio.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/Isaac-Fate/stox/blob/master/book/trading-strategy/effective-portfolio.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Isaac-Fate/stox/tree/master/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Isaac-Fate/stox/tree/master//issues/new?title=Issue%20on%20page%20%2Ftrading-strategy/effective-portfolio.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/trading-strategy/effective-portfolio.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#candidate-companies">
   Candidate Companies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stock-returns">
   Stock Returns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volatility">
   Volatility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#weighted-stock-returns">
   Weighted Stock Returns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monte-carlo-simulation">
   Monte Carlo Simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sharpe-ratio">
   Sharpe Ratio
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Effective Portfolio</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#candidate-companies">
   Candidate Companies
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stock-returns">
   Stock Returns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volatility">
   Volatility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#weighted-stock-returns">
   Weighted Stock Returns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monte-carlo-simulation">
   Monte Carlo Simulation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sharpe-ratio">
   Sharpe Ratio
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="effective-portfolio">
<h1>Effective Portfolio<a class="headerlink" href="#effective-portfolio" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="candidate-companies">
<h2>Candidate Companies<a class="headerlink" href="#candidate-companies" title="Permalink to this headline">#</a></h2>
<p>Recall that we have selected the most profitable company in each sector in the sense of <strong>dollar values</strong>. We now load the tickers of these candidate companies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../../data/companies.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">companies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">companies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;META&#39;, &#39;TSLA&#39;, &#39;XOM&#39;, &#39;BAC&#39;, &#39;UNH&#39;, &#39;BA&#39;, &#39;AAPL&#39;]
</pre></div>
</div>
</div>
</div>
<p>We then put the closing prices of these companies side by side in a data frame:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_days</span> <span class="o">=</span> <span class="mi">90</span>

<span class="c1"># load data</span>
<span class="n">stocks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../data/stocks.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="o">-</span><span class="n">num_days</span><span class="p">]</span>

<span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">company</span> <span class="ow">in</span> <span class="n">companies</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">stocks</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Company == &#39;</span><span class="si">{</span><span class="n">company</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)[[</span><span class="s2">&quot;Close&quot;</span><span class="p">]]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Close&quot;</span><span class="p">:</span> <span class="n">company</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># join stock prices of different companies</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="c1"># leave last 90 days out</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="o">-</span><span class="n">num_days</span><span class="p">]</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>META</th>
      <th>TSLA</th>
      <th>XOM</th>
      <th>BAC</th>
      <th>UNH</th>
      <th>BA</th>
      <th>AAPL</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-11-02</th>
      <td>178.919998</td>
      <td>19.950666</td>
      <td>83.529999</td>
      <td>27.870001</td>
      <td>211.100006</td>
      <td>262.630005</td>
      <td>42.027500</td>
    </tr>
    <tr>
      <th>2017-11-03</th>
      <td>178.919998</td>
      <td>20.406000</td>
      <td>83.180000</td>
      <td>27.820000</td>
      <td>212.869995</td>
      <td>261.750000</td>
      <td>43.125000</td>
    </tr>
    <tr>
      <th>2017-11-06</th>
      <td>180.169998</td>
      <td>20.185333</td>
      <td>83.750000</td>
      <td>27.750000</td>
      <td>212.119995</td>
      <td>264.070007</td>
      <td>43.562500</td>
    </tr>
    <tr>
      <th>2017-11-07</th>
      <td>180.250000</td>
      <td>20.403334</td>
      <td>83.580002</td>
      <td>27.180000</td>
      <td>212.699997</td>
      <td>266.130005</td>
      <td>43.702499</td>
    </tr>
    <tr>
      <th>2017-11-08</th>
      <td>179.559998</td>
      <td>20.292667</td>
      <td>83.470001</td>
      <td>26.790001</td>
      <td>210.770004</td>
      <td>265.570007</td>
      <td>44.060001</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-06-17</th>
      <td>163.740005</td>
      <td>216.759995</td>
      <td>86.120003</td>
      <td>31.920000</td>
      <td>452.059998</td>
      <td>136.800003</td>
      <td>131.559998</td>
    </tr>
    <tr>
      <th>2022-06-21</th>
      <td>157.050003</td>
      <td>237.036667</td>
      <td>91.480003</td>
      <td>32.849998</td>
      <td>480.320007</td>
      <td>136.750000</td>
      <td>135.869995</td>
    </tr>
    <tr>
      <th>2022-06-22</th>
      <td>155.850006</td>
      <td>236.086670</td>
      <td>87.860001</td>
      <td>32.599998</td>
      <td>489.679993</td>
      <td>137.160004</td>
      <td>135.350006</td>
    </tr>
    <tr>
      <th>2022-06-23</th>
      <td>158.750000</td>
      <td>235.070007</td>
      <td>85.209999</td>
      <td>32.080002</td>
      <td>499.809998</td>
      <td>133.970001</td>
      <td>138.270004</td>
    </tr>
    <tr>
      <th>2022-06-24</th>
      <td>170.160004</td>
      <td>245.706665</td>
      <td>86.900002</td>
      <td>32.310001</td>
      <td>495.640015</td>
      <td>141.529999</td>
      <td>141.660004</td>
    </tr>
  </tbody>
</table>
<p>1168 rows × 7 columns</p>
</div></div></div>
</div>
</section>
<section id="stock-returns">
<h2>Stock Returns<a class="headerlink" href="#stock-returns" title="Permalink to this headline">#</a></h2>
<p>A <strong>stock return</strong> is the change in price of an asset, investment, or project over time, which may be represented in terms of price change or percentage change. In fact, we have already introduced this concept when calculating the profit in a previous section.</p>
<div class="math notranslate nohighlight">
\[
\text{Today's Stock Return} = \frac{\text{Today's Price} - \text{Yesterday's Price}}{\text{Yesterday's Price}}
\]</div>
<p>Sometimes, it is preferred to use the <strong>log return</strong>:</p>
<div class="math notranslate nohighlight">
\[
\text{Log Return} = \log \left( 1 + \text{Stock Return} \right)
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standard returns</span>
<span class="n">stock_returns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># log returns</span>
<span class="n">stock_returns</span> <span class="o">=</span> <span class="n">stock_returns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">stock_returns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>META</th>
      <th>TSLA</th>
      <th>XOM</th>
      <th>BAC</th>
      <th>UNH</th>
      <th>BA</th>
      <th>AAPL</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-11-03</th>
      <td>0.000000</td>
      <td>0.022566</td>
      <td>-0.004199</td>
      <td>-0.001796</td>
      <td>0.008350</td>
      <td>-0.003356</td>
      <td>0.025779</td>
    </tr>
    <tr>
      <th>2017-11-06</th>
      <td>0.006962</td>
      <td>-0.010873</td>
      <td>0.006829</td>
      <td>-0.002519</td>
      <td>-0.003529</td>
      <td>0.008824</td>
      <td>0.010094</td>
    </tr>
    <tr>
      <th>2017-11-07</th>
      <td>0.000444</td>
      <td>0.010742</td>
      <td>-0.002032</td>
      <td>-0.020754</td>
      <td>0.002731</td>
      <td>0.007771</td>
      <td>0.003209</td>
    </tr>
    <tr>
      <th>2017-11-08</th>
      <td>-0.003835</td>
      <td>-0.005439</td>
      <td>-0.001317</td>
      <td>-0.014453</td>
      <td>-0.009115</td>
      <td>-0.002106</td>
      <td>0.008147</td>
    </tr>
    <tr>
      <th>2017-11-09</th>
      <td>-0.001449</td>
      <td>-0.004610</td>
      <td>0.005972</td>
      <td>-0.011261</td>
      <td>0.003741</td>
      <td>-0.010866</td>
      <td>-0.002045</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-06-17</th>
      <td>0.017683</td>
      <td>0.017029</td>
      <td>-0.059394</td>
      <td>0.002195</td>
      <td>-0.008875</td>
      <td>0.025468</td>
      <td>0.011467</td>
    </tr>
    <tr>
      <th>2022-06-21</th>
      <td>-0.041716</td>
      <td>0.089424</td>
      <td>0.060379</td>
      <td>0.028719</td>
      <td>0.060638</td>
      <td>-0.000366</td>
      <td>0.032236</td>
    </tr>
    <tr>
      <th>2022-06-22</th>
      <td>-0.007670</td>
      <td>-0.004016</td>
      <td>-0.040376</td>
      <td>-0.007639</td>
      <td>0.019300</td>
      <td>0.002994</td>
      <td>-0.003834</td>
    </tr>
    <tr>
      <th>2022-06-23</th>
      <td>0.018437</td>
      <td>-0.004316</td>
      <td>-0.030626</td>
      <td>-0.016079</td>
      <td>0.020476</td>
      <td>-0.023532</td>
      <td>0.021344</td>
    </tr>
    <tr>
      <th>2022-06-24</th>
      <td>0.069409</td>
      <td>0.044255</td>
      <td>0.019639</td>
      <td>0.007144</td>
      <td>-0.008378</td>
      <td>0.054896</td>
      <td>0.024222</td>
    </tr>
  </tbody>
</table>
<p>1167 rows × 7 columns</p>
</div></div></div>
</div>
</section>
<section id="volatility">
<h2>Volatility<a class="headerlink" href="#volatility" title="Permalink to this headline">#</a></h2>
<p>Suppose the proportion / weight of money we want to invest in each stock is <span class="math notranslate nohighlight">\(w_i\)</span>. Then the <strong>volatility</strong> of the portfolio is given by</p>
<div class="math notranslate nohighlight">
\[
\text{Volatility} = \sqrt{\mathbf{w}^\top \Sigma \mathbf{w}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{w} = (w_1, \ldots, w_n)^\top\)</span> (assuming there are <span class="math notranslate nohighlight">\(n\)</span> companies), and <span class="math notranslate nohighlight">\(\Sigma\)</span> is the covariance matrix of the daily stock returns, which can be computed by <code class="docutils literal notranslate"><span class="pre">np.cov(stock_returns.T)</span></code> or <code class="docutils literal notranslate"><span class="pre">stock_returns.cov()</span></code> since <code class="docutils literal notranslate"><span class="pre">stock_returns</span></code> is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<p>Covariance matrix of stock returns, <span class="math notranslate nohighlight">\(\Sigma\)</span>:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is recommended to use Pandas’ functions when experimenting if your data is a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> since the output is somewhat nicer. While in actual production, NumPy is preferred.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stock_returns</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>META</th>
      <th>TSLA</th>
      <th>XOM</th>
      <th>BAC</th>
      <th>UNH</th>
      <th>BA</th>
      <th>AAPL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>META</th>
      <td>0.000664</td>
      <td>0.000371</td>
      <td>0.000139</td>
      <td>0.000207</td>
      <td>0.000169</td>
      <td>0.000284</td>
      <td>0.000311</td>
    </tr>
    <tr>
      <th>TSLA</th>
      <td>0.000371</td>
      <td>0.001678</td>
      <td>0.000181</td>
      <td>0.000260</td>
      <td>0.000193</td>
      <td>0.000457</td>
      <td>0.000396</td>
    </tr>
    <tr>
      <th>XOM</th>
      <td>0.000139</td>
      <td>0.000181</td>
      <td>0.000449</td>
      <td>0.000303</td>
      <td>0.000172</td>
      <td>0.000371</td>
      <td>0.000154</td>
    </tr>
    <tr>
      <th>BAC</th>
      <td>0.000207</td>
      <td>0.000260</td>
      <td>0.000303</td>
      <td>0.000500</td>
      <td>0.000216</td>
      <td>0.000436</td>
      <td>0.000217</td>
    </tr>
    <tr>
      <th>UNH</th>
      <td>0.000169</td>
      <td>0.000193</td>
      <td>0.000172</td>
      <td>0.000216</td>
      <td>0.000362</td>
      <td>0.000254</td>
      <td>0.000198</td>
    </tr>
    <tr>
      <th>BA</th>
      <td>0.000284</td>
      <td>0.000457</td>
      <td>0.000371</td>
      <td>0.000436</td>
      <td>0.000254</td>
      <td>0.001041</td>
      <td>0.000295</td>
    </tr>
    <tr>
      <th>AAPL</th>
      <td>0.000311</td>
      <td>0.000396</td>
      <td>0.000154</td>
      <td>0.000217</td>
      <td>0.000198</td>
      <td>0.000295</td>
      <td>0.000429</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Then, the volatility can be calculated by (assuming the weights are all equal)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_companies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span>

<span class="c1"># assign equal weights</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_companies</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_companies</span>

<span class="c1"># convert to column vector</span>
<span class="n">weight_vec</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># volatility</span>
<span class="n">volatility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weight_vec</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">stock_returns</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">weight_vec</span><span class="p">)</span>
<span class="n">volatility</span> <span class="o">=</span> <span class="n">volatility</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="n">volatility</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.01823466003794474
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_volatility</span><span class="p">(</span><span class="n">stock_returns</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    
    <span class="c1"># scale weights</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1"># convert to column vector</span>
    <span class="n">weight_vec</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># volatility</span>
    <span class="n">volatility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weight_vec</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">stock_returns</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">weight_vec</span><span class="p">)</span>
    <span class="n">volatility</span> <span class="o">=</span> <span class="n">volatility</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">volatility</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="weighted-stock-returns">
<h2>Weighted Stock Returns<a class="headerlink" href="#weighted-stock-returns" title="Permalink to this headline">#</a></h2>
<p>For a certain portfolio, the <strong>weighted stock return</strong> is simply the sum of weighted returns of all invested stocks.</p>
<div class="math notranslate nohighlight">
\[
\text{Weighted Stock Return} 
= \mathbf{w}^\top \mathbf{r}
= \sum_{i=1}^n w_i r_i
\]</div>
<p>where <span class="math notranslate nohighlight">\(r_i\)</span> is the <em>average</em> stock return of the <span class="math notranslate nohighlight">\(i\)</span>-th company.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weighted_stock_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">stock_returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">weighted_stock_return</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0005017068811196133
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_weighted_stock_return</span><span class="p">(</span><span class="n">stock_returns</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    
    <span class="c1"># scale weights</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">stock_returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="monte-carlo-simulation">
<h2>Monte Carlo Simulation<a class="headerlink" href="#monte-carlo-simulation" title="Permalink to this headline">#</a></h2>
<p>We generate weight for each company is selected with equal probabilities and then calculate the stock return as well as the volatility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set seed</span>
<span class="n">SEED</span> <span class="o">=</span> <span class="mi">7008</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>

<span class="c1"># the weight for each company is selected with equal probabilities</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">simulated_weights</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">num_companies</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># calculate volatility for each portfolio</span>
<span class="n">volatilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
    <span class="n">partial</span><span class="p">(</span><span class="n">calc_volatility</span><span class="p">,</span> <span class="n">stock_returns</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">arr</span><span class="o">=</span><span class="n">simulated_weights</span>
<span class="p">)</span>

<span class="c1"># calculate stock return for each portfolio</span>
<span class="n">weighted_stock_returns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
    <span class="n">partial</span><span class="p">(</span><span class="n">calc_weighted_stock_return</span><span class="p">,</span> <span class="n">stock_returns</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">arr</span><span class="o">=</span><span class="n">simulated_weights</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the stock return against the volatility for each portfolio:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">volatilities</span><span class="p">,</span> <span class="n">weighted_stock_returns</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Volatility&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Stock Return&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/effective-portfolio_27_0.png" src="../_images/effective-portfolio_27_0.png" />
</div>
</div>
</section>
<section id="sharpe-ratio">
<h2>Sharpe Ratio<a class="headerlink" href="#sharpe-ratio" title="Permalink to this headline">#</a></h2>
<p>The Sharpe ratio is given by</p>
<div class="math notranslate nohighlight">
\[
\text{Shape Ratio} = \frac{\text{Stock Return}}{\text{Volatility}}
\]</div>
<p>We want the portfolio with as high Sharpe ratio as possible since we prefer high stock return and low volatility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate Sharpe ratio</span>
<span class="n">sharpe_ratio</span> <span class="o">=</span> <span class="n">weighted_stock_returns</span> <span class="o">/</span> <span class="n">volatilities</span>

<span class="c1"># find the portfolio that maximize the sharpe ratio</span>
<span class="n">optimal_weight_ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sharpe_ratio</span><span class="p">)</span>
<span class="n">optimal_weight</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">simulated_weights</span><span class="p">[</span><span class="n">optimal_weight_ix</span><span class="p">]</span>

<span class="c1"># scale the weights</span>
<span class="n">optimal_weight</span> <span class="o">=</span> <span class="n">optimal_weight</span> <span class="o">/</span> <span class="n">optimal_weight</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">optimal_weight</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.00808913, 0.20070573, 0.10093622, 0.00323051, 0.34447254,
       0.01460107, 0.32796482])
</pre></div>
</div>
</div>
</div>
<p>The optimal portfolio is marked as red star in the following plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">volatilities</span><span class="p">,</span> <span class="n">weighted_stock_returns</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">volatilities</span><span class="p">[</span><span class="n">optimal_weight_ix</span><span class="p">],</span> <span class="n">weighted_stock_returns</span><span class="p">[</span><span class="n">optimal_weight_ix</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Volatility&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Stock Return&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/effective-portfolio_33_0.png" src="../_images/effective-portfolio_33_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Isaac-Fate/stox",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./trading-strategy"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="trading-by-prediction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Trading by Prediction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../news-investigation/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">News Investigation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Isaac Fei<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>